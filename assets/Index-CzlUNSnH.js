var ve=Object.defineProperty;var je=(s,t,n)=>t in s?ve(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n;var I=(s,t,n)=>je(s,typeof t!="symbol"?t+"":t,n);import{r as o,j as e,m as O,I as we,n as U,o as H,p as Ne,q as Q,s as Se,v as $,w as ke,L as G,x as B,y as Ee,z as Ce,E as qe,F as _,G as Ie,H as Me,J as Re,g as D,K as ze,M as Te,N as Ae,O as J,U as K,Y as X,Z,_ as ee,$ as se,a0 as te,a1 as ne,a2 as Le,a3 as Fe,a4 as Pe,a5 as De,a6 as Ve,a7 as We,a8 as Ye,a9 as oe,aa as Oe,ab as Ue,ac as ae,ad as He,ae as Qe,af as $e,ag as Ge,ah as V,ai as Be,aj as _e,ak as Je,al as Ke,am as Xe}from"./vendor-BEeOnL8G.js";import{c as S,u as M,B as T,t as z,a as re,A as Ze,b as es,T as ss}from"./index-UyIZ1MNz.js";const ts=Ie,ns=Me,ie=o.forwardRef(({className:s,children:t,...n},a)=>e.jsxs(O,{ref:a,className:S("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...n,children:[t,e.jsx(we,{asChild:!0,children:e.jsx(U,{className:"h-4 w-4 opacity-50"})})]}));ie.displayName=O.displayName;const le=o.forwardRef(({className:s,...t},n)=>e.jsx(H,{ref:n,className:S("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(Ne,{className:"h-4 w-4"})}));le.displayName=H.displayName;const ce=o.forwardRef(({className:s,...t},n)=>e.jsx(Q,{ref:n,className:S("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(U,{className:"h-4 w-4"})}));ce.displayName=Q.displayName;const ue=o.forwardRef(({className:s,children:t,position:n="popper",...a},r)=>e.jsx(Se,{children:e.jsxs($,{ref:r,className:S("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...a,children:[e.jsx(le,{}),e.jsx(ke,{className:S("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(ce,{})]})}));ue.displayName=$.displayName;const os=o.forwardRef(({className:s,...t},n)=>e.jsx(G,{ref:n,className:S("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...t}));os.displayName=G.displayName;const de=o.forwardRef(({className:s,children:t,...n},a)=>e.jsxs(B,{ref:a,className:S("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ee,{children:e.jsx(Ce,{className:"h-4 w-4"})})}),e.jsx(qe,{children:t})]}));de.displayName=B.displayName;const as=o.forwardRef(({className:s,...t},n)=>e.jsx(_,{ref:n,className:S("-mx-1 my-1 h-px bg-muted",s),...t}));as.displayName=_.displayName;const rs={en:"English",es:"EspaÃ±ol",fr:"FranÃ§ais",de:"Deutsch",zh:"ä¸­æ–‡",ja:"æ—¥æœ¬èªž"},is=()=>{const{language:s,setLanguage:t}=M(),n=a=>{t(a)};return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Re,{size:18,className:"text-muted-foreground"}),e.jsxs(ts,{value:s,onValueChange:n,children:[e.jsx(ie,{className:"w-[120px]",children:e.jsx(ns,{placeholder:"Language"})}),e.jsx(ue,{children:Object.entries(rs).map(([a,r])=>e.jsx(de,{value:a,children:r},a))})]})]})},ls=({onLoginClick:s})=>{const[t,n]=D.useState("light"),[a,r]=D.useState(!1),{t:i}=M(),u=()=>{const d=t==="light"?"dark":"light";n(d),document.documentElement.classList.toggle("dark",d==="dark")},c=()=>{r(!a),s&&s()};return e.jsx("header",{className:"px-4 py-3 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs("div",{className:"container flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("img",{src:"/images/logo.png",alt:"Cybella Logo",className:"h-12 w-auto"})}),e.jsx("h1",{className:"text-xl font-semibold text-primary",children:"Cybella"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(is,{}),e.jsxs(T,{variant:"outline",size:"sm",onClick:c,className:"flex items-center gap-1",children:[e.jsx(ze,{size:18}),e.jsx("span",{children:i(a?"signOut":"signIn","header")})]}),e.jsxs(T,{variant:"ghost",size:"icon",onClick:u,children:[t==="light"?e.jsx(Te,{size:20}):e.jsx(Ae,{size:20}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})]})]})})},cs=()=>{const{t:s}=M(),t=new Date().getFullYear();return e.jsx("footer",{className:"py-4 px-6 border-t bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("rights","footer",{year:t})}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 md:mt-0",children:[e.jsx("a",{href:"#",className:"text-sm text-muted-foreground hover:text-foreground",children:s("privacy","footer")}),e.jsx("a",{href:"#",className:"text-sm text-muted-foreground hover:text-foreground",children:s("terms","footer")}),e.jsx("a",{href:"#",className:"text-sm text-muted-foreground hover:text-foreground",children:s("contact","footer")})]})]}),e.jsx("div",{className:"mt-4 text-xs text-center text-muted-foreground",children:s("disclaimer","footer")})]})})},A=o.forwardRef(({className:s,...t},n)=>e.jsx("div",{ref:n,className:S("rounded-lg border bg-card text-card-foreground shadow-sm",s),...t}));A.displayName="Card";const me=o.forwardRef(({className:s,...t},n)=>e.jsx("div",{ref:n,className:S("flex flex-col space-y-1.5 p-6",s),...t}));me.displayName="CardHeader";const he=o.forwardRef(({className:s,...t},n)=>e.jsx("h3",{ref:n,className:S("text-2xl font-semibold leading-none tracking-tight",s),...t}));he.displayName="CardTitle";const fe=o.forwardRef(({className:s,...t},n)=>e.jsx("p",{ref:n,className:S("text-sm text-muted-foreground",s),...t}));fe.displayName="CardDescription";const ge=o.forwardRef(({className:s,...t},n)=>e.jsx("div",{ref:n,className:S("p-6 pt-0",s),...t}));ge.displayName="CardContent";const us=o.forwardRef(({className:s,...t},n)=>e.jsx("div",{ref:n,className:S("flex items-center p-6 pt-0",s),...t}));us.displayName="CardFooter";const ds=({sessionActive:s,toggleSession:t})=>{const{t:n}=M();return e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsx(T,{onClick:t,variant:s?"destructive":"default",className:"w-full md:w-auto",children:s?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mr-2",size:16}),n("endSession","voice")]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2",size:16}),n("startSession","voice")]})})})},L=o.forwardRef(({className:s,...t},n)=>e.jsx(X,{ref:n,className:S("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...t}));L.displayName=X.displayName;const ms=o.forwardRef(({className:s,...t},n)=>e.jsx(Z,{ref:n,className:S("aspect-square h-full w-full",s),...t}));ms.displayName=Z.displayName;const F=o.forwardRef(({className:s,...t},n)=>e.jsx(ee,{ref:n,className:S("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...t}));F.displayName=ee.displayName;const hs=({transcription:s,interimTranscript:t,isListening:n,sessionActive:a})=>!a||!!!(s||t)?null:e.jsxs("div",{className:"flex items-start gap-3 justify-end",children:[e.jsx("div",{className:"bg-primary/90 text-primary-foreground rounded-lg rounded-tr-none p-3 max-w-[90%] shadow-sm",children:e.jsxs("p",{className:"text-sm",children:[s||t,n&&e.jsx("span",{className:"animate-pulse",children:"..."})]})}),e.jsx(L,{className:"border border-primary/50 bg-background",children:e.jsx(F,{children:"You"})})]});function fs({text:s,autoplay:t=!1}){const[n,a]=o.useState(!1),[r,i]=o.useState(!1),[u,c]=o.useState(75),{language:d}=M(),h={en:"en-US",es:"es-ES",fr:"fr-FR",de:"de-DE",zh:"zh-CN",ja:"ja-JP"},f=o.useRef(null);o.useEffect(()=>()=>{f.current&&window.speechSynthesis.cancel()},[]),o.useEffect(()=>{t&&s&&!r&&p()},[s,t,r]);const p=()=>{if(!s||r)return;window.speechSynthesis.cancel();const w=h[d]||"en-US",v=new SpeechSynthesisUtterance(s);v.volume=u/100,v.lang=w;const E=window.speechSynthesis.getVoices().find(l=>l.lang.startsWith(w));E&&(v.voice=E),v.onstart=()=>a(!0),v.onend=()=>a(!1),v.onerror=()=>a(!1),f.current=v,window.speechSynthesis.speak(v)};return{isPlaying:n,isMuted:r,volume:u,handlePlay:p,toggleMute:()=>{n&&!r&&(window.speechSynthesis.cancel(),a(!1)),i(!r)},handleVolumeChange:w=>{c(w),f.current&&(f.current.volume=w/100)}}}const gs=({isPlaying:s,onClick:t})=>e.jsx(T,{variant:"outline",size:"icon",onClick:t,className:`${s?"bg-primary text-primary-foreground":""}`,children:s?e.jsx(J,{size:16}):e.jsx(K,{size:16})}),ps=({isMuted:s,onClick:t})=>e.jsx(T,{variant:"outline",size:"icon",onClick:t,children:s?e.jsx(se,{size:16}):e.jsx(te,{size:16})}),pe=o.forwardRef(({className:s,...t},n)=>e.jsxs(ne,{ref:n,className:S("relative flex w-full touch-none select-none items-center",s),...t,children:[e.jsx(Le,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Fe,{className:"absolute h-full bg-primary"})}),e.jsx(Pe,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));pe.displayName=ne.displayName;const xs=({value:s,onValueChange:t})=>{const n=r=>{t(r[0])},a=()=>s===0?e.jsx(se,{size:16}):s<.33?e.jsx(De,{size:16}):s<.66?e.jsx(Ve,{size:16}):e.jsx(te,{size:16});return e.jsxs("div",{className:"flex items-center gap-2 w-32",children:[e.jsx(a,{}),e.jsx(pe,{defaultValue:[s],value:[s],max:1,step:.01,onValueChange:n,className:"flex-1"})]})},ys=({text:s,autoplay:t=!1})=>{const{isPlaying:n,isMuted:a,volume:r,handlePlay:i,toggleMute:u,handleVolumeChange:c}=fs({text:s,autoplay:t});return s?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{isPlaying:n,onClick:i}),e.jsx(ps,{isMuted:a,onClick:u}),e.jsx(xs,{value:r,onValueChange:c})]}):null},bs=({processingInput:s,aiResponse:t,shouldPlayVoice:n,sessionActive:a})=>e.jsxs("div",{className:"flex flex-col space-y-4",children:[(s||t)&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(L,{className:"border border-primary bg-primary/10",children:e.jsx(F,{className:"text-primary",children:"AI"})}),e.jsx("div",{className:"bg-muted/30 rounded-lg rounded-tl-none p-3 max-w-[90%]",children:s&&!t?e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full animate-pulse mr-1"}),e.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full animate-pulse mx-1"}),e.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full animate-pulse ml-1"})]}):t?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:t}),n&&e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx(ys,{text:t,autoplay:n})})]}):null})]}),!s&&!t&&a&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Say something to start the conversation"})}),!a&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start a session to chat with Cybella"})})]}),vs=({isListening:s,audioData:t})=>{const[n,a]=o.useState(Array(10).fill(3));return o.useEffect(()=>{if(!s){a(Array(10).fill(3));return}if(t){const r=Array(10).fill(0).map((i,u)=>{const c=Math.floor(u*(t.length/10));return Math.max(3,Math.min(20,3+t[c]/255*17))});a(r)}else{const r=setInterval(()=>{a(Array(10).fill(0).map(()=>s?Math.max(3,Math.floor(Math.random()*20)):3))},100);return()=>clearInterval(r)}},[s,t]),e.jsxs("div",{className:"audio-wave",children:[n.map((r,i)=>e.jsx("div",{className:"audio-wave-bar",style:{height:`${r}px`,opacity:s?1:.5,backgroundColor:s?"#4f46e5":"#a8a8a8",transition:"height 0.2s ease-in-out, background-color 0.3s ease"}},i)),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
        .audio-wave {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 3px;
          height: 30px;
        }
        .audio-wave-bar {
          width: 4px;
          border-radius: 2px;
          transform-origin: bottom;
        }
      `}})]})},js=({isListening:s,audioData:t,sessionActive:n,processingInput:a,toggleListening:r})=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-1",children:s&&t&&e.jsx(vs,{isListening:s,audioData:t})}),e.jsx(T,{variant:"default",size:"icon",className:`w-12 h-12 rounded-full shadow-md ${s?"bg-red-500 hover:bg-red-600":"bg-primary hover:bg-primary/90"}`,disabled:!n||a,onClick:r,children:s?e.jsx(We,{size:20}):e.jsx(Ye,{size:20})})]});class ws{constructor(){I(this,"recognition",null);I(this,"isListening",!1);I(this,"onResultCallback",null);I(this,"onEndCallback",null);I(this,"audioContext",null);I(this,"analyzer",null);I(this,"microphone",null);I(this,"audioDataArray",null);const t=window.SpeechRecognition||window.webkitSpeechRecognition;t&&(this.recognition=new t,this.recognition.continuous=!0,this.recognition.interimResults=!0,this.recognition.lang="en-US")}setupRecognitionEvents(){this.recognition&&(this.recognition.onresult=t=>{if(this.onResultCallback&&t.results.length>0){const n=t.results[t.results.length-1],a=n[0].transcript,r=n.isFinal;this.onResultCallback(a,r)}},this.recognition.onend=()=>{this.isListening=!1,this.onEndCallback&&this.onEndCallback()},this.recognition.onerror=t=>{console.error("Speech recognition error:",t.error),this.isListening=!1})}configure(t={}){this.recognition&&(t.continuous!==void 0&&(this.recognition.continuous=t.continuous),t.interimResults!==void 0&&(this.recognition.interimResults=t.interimResults),t.language&&(this.recognition.lang=t.language))}async start(){if(!(!this.recognition||this.isListening))try{this.audioContext||await this.setupAudioAnalyzer(),this.setupRecognitionEvents(),this.recognition.start(),this.isListening=!0}catch(t){console.error("Failed to start speech recognition:",t)}}stop(){this.recognition&&this.isListening&&(this.recognition.stop(),this.isListening=!1),this.microphone&&this.microphone.disconnect()}onResult(t){this.onResultCallback=t}onEnd(t){this.onEndCallback=t}async setupAudioAnalyzer(){try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});this.audioContext=new AudioContext,this.analyzer=this.audioContext.createAnalyser(),this.analyzer.fftSize=256,this.microphone=this.audioContext.createMediaStreamSource(t),this.microphone.connect(this.analyzer);const n=this.analyzer.frequencyBinCount;this.audioDataArray=new Uint8Array(n)}catch(t){console.error("Error setting up audio analyzer:",t)}}getAudioData(){return this.analyzer&&this.audioDataArray&&this.isListening?(this.analyzer.getByteFrequencyData(this.audioDataArray),this.audioDataArray):null}static isSupported(){return!!(window.SpeechRecognition||window.webkitSpeechRecognition)}}const R=new ws;function Ns({sessionActive:s,onTranscriptionComplete:t}){const[n,a]=o.useState(!1),[r,i]=o.useState(""),[u,c]=o.useState(""),d=typeof window<"u"&&(typeof window.SpeechRecognition<"u"||typeof window.webkitSpeechRecognition<"u");o.useEffect(()=>{if(!d){z({title:"Speech Recognition Not Supported",description:"Your browser doesn't support speech recognition. Please use Chrome, Edge, or Safari.",variant:"destructive"});return}R.configure({continuous:!0,interimResults:!0,language:"en-US"}),R.onResult((m,x)=>{x?(i(m),c(""),n&&(p(),t&&t(m))):c(m)}),R.onEnd(()=>{a(!1)})},[n,d,t]);const h=async()=>{n?p():await f()},f=async()=>{if(!(!s||!d))try{await R.start(),a(!0)}catch(m){console.error("Error starting speech recognition:",m),z({title:"Microphone Error",description:"Could not access microphone. Please check permissions.",variant:"destructive"})}},p=()=>{R.stop(),a(!1)};return{isListening:n,transcription:r,interimTranscript:u,speechRecognitionSupported:d,toggleListening:h,startListening:f,stopListening:p}}function Ss(s){const[t,n]=o.useState(null);return o.useEffect(()=>{let a=null;return s?a=setInterval(()=>{const r=R.getAudioData();r&&n(r)},100):n(null),()=>{a&&clearInterval(a)}},[s]),t}function ks({sessionActive:s,onVoiceEmotionDetected:t}){const[n,a]=o.useState([]),r=o.useCallback(()=>{if(!s||!t)return;const c=["happy","sad","neutral","surprised","fearful","angry"],d=c[Math.floor(Math.random()*c.length)],h=.6+Math.random()*.3;t(d,h)},[s,t]),i=o.useCallback(c=>{a(d=>[...d,c].slice(-5))},[]),u=o.useCallback(()=>{if(n.length===0)return null;const c=n.reduce((h,f)=>(h[f]=(h[f]||0)+1,h),{});return Object.entries(c).sort((h,f)=>f[1]-h[1])[0][0]},[n]);return{simulateVoiceEmotionDetection:r,recordEmotion:i,getStableEmotion:u,recentEmotions:n}}function Es(){const[s,t]=o.useState(""),[n,a]=o.useState(!1),[r,i]=o.useState(!1),{language:u}=M(),{preferences:c,addPreference:d}=re(),[h,f]=o.useState("initial"),[p,m]=o.useState(0);o.useEffect(()=>{h!=="initial"&&m(0)},[h]);const x=l=>{if(!l.trim())return;t(""),a(!1),i(!0),m(k=>k+1);const y=p>=2;w(l.toLowerCase());let j=q(l.toLowerCase()),N=E(j,y);const g=1e3+Math.random()*1e3,C=setTimeout(()=>{let k=0;const b=setInterval(()=>{k<=N.length?(t(N.substring(0,k)),k++,Math.random()>.9&&(clearInterval(b),setTimeout(()=>{const P=setInterval(()=>{k<=N.length?(t(N.substring(0,k)),k++):(clearInterval(P),i(!1),a(!0))},30+Math.random()*50)},200+Math.random()*300))):(clearInterval(b),i(!1),a(!0))},30+Math.random()*50)},g);return()=>{clearTimeout(C)}},w=l=>{if((l.includes("like to")||l.includes("enjoy")||l.includes("hobby")||l.includes("hobbies"))&&!l.includes("what")&&!l.includes("?")){const y=v(l);y.length>0&&y.forEach(j=>{j.length>2&&d("hobbies",j.trim())})}if((l.includes("favorite place")||l.includes("like to go")||l.includes("love to visit"))&&!l.includes("what")&&!l.includes("?")){const y=v(l);y.length>0&&y.forEach(j=>{j.length>2&&d("favoritePlaces",j.trim())})}if((l.includes("game")||l.includes("play"))&&!l.includes("what")&&!l.includes("?")){const y=v(l);y.length>0&&y.forEach(j=>{j.length>2&&d("favoriteGames",j.trim())})}if((l.includes("friend")||l.includes("best friend"))&&!l.includes("what")&&!l.includes("?")){const y=v(l);y.length>0&&y.forEach(j=>{j.length>2&&d("bestFriends",j.trim())})}if((l.includes("food")||l.includes("eat")||l.includes("favorite meal"))&&!l.includes("what")&&!l.includes("?")){const y=v(l);y.length>0&&y.forEach(j=>{j.length>2&&d("favoriteFood",j.trim())})}},v=l=>l.split(/\s+/).filter(N=>N.length>3&&!["like","enjoy","favorite","love","hobby","hobbies","place","game","play","friend"].includes(N)),q=l=>l.includes("anxious")||l.includes("anxiety")||l.includes("worried")||l.includes("panic")||l.includes("ansie")||l.includes("ansiedad")||l.includes("anxiÃ©tÃ©")?"anxiety":l.includes("depress")||l.includes("sad")||l.includes("hopeless")||l.includes("meaningless")||l.includes("triste")||l.includes("dÃ©primÃ©")?"depression":l.includes("stress")||l.includes("overwhelm")||l.includes("too much")||l.includes("pressure")||l.includes("presiÃ³n")||l.includes("pression")?"stress":"general",E=(l,y)=>{const j={en:{anxiety:["I notice you're feeling anxious. Would you like to talk more about what's causing that feeling?","Anxiety can be tough to deal with. What helps you feel calmer when you're anxious?","I'm hearing some anxiety in your voice. Let's take a deep breath together first, and then you can tell me more."],depression:["It sounds like you might be feeling down. I'm here to listen if you want to talk about it.","Those feelings are valid. What small thing might bring you a moment of peace today?","Thank you for sharing that with me. Depression can feel isolating, but you're not alone right now."],stress:["It seems like you're under a lot of pressure. What's weighing on you the most right now?","I hear that you're stressed. Would talking through some of those concerns help?","Let's take a moment to focus on what's happening right now. What's one thing that's in your control?"],general:["Thanks for sharing that with me. How long have you been feeling this way?","I'm listening. What else is on your mind?","I appreciate you opening up. Would it help to explore what might be behind those feelings?","I'm glad you're talking with me about this. What do you think would help you feel better right now?"],askHobbies:["I'd like to get to know you better. What are some hobbies or activities you enjoy?","What do you like to do in your free time?"],askPlaces:["Do you have any favorite places you like to visit or spend time at?","Is there a special place that helps you feel relaxed when you go there?"],askGames:["Do you enjoy playing any games? Video games, board games, or sports perhaps?","What games do you find most enjoyable or relaxing?"],askFriends:["Do you have close friends you like to spend time with?","Who's someone that always manages to cheer you up when you're feeling down?"],askFood:["What kinds of food do you enjoy the most?","Do you have any comfort foods that help when you're not feeling your best?"]},es:{anxiety:["Noto que te sientes ansioso. Â¿Te gustarÃ­a hablar mÃ¡s sobre quÃ© estÃ¡ causando ese sentimiento?","La ansiedad puede ser difÃ­cil de manejar. Â¿QuÃ© te ayuda a sentirte mÃ¡s tranquilo cuando estÃ¡s ansioso?","Escucho algo de ansiedad en tu voz. Respiremos profundo juntos primero, y luego me puedes contar mÃ¡s."],depression:["Parece que podrÃ­as estar sintiÃ©ndote triste. Estoy aquÃ­ para escucharte si quieres hablar de ello.","Esos sentimientos son vÃ¡lidos. Â¿QuÃ© pequeÃ±a cosa podrÃ­a traerte un momento de paz hoy?","Gracias por compartir eso conmigo. La depresiÃ³n puede sentirse aislante, pero no estÃ¡s solo en este momento."],stress:["Parece que estÃ¡s bajo mucha presiÃ³n. Â¿QuÃ© es lo que mÃ¡s te pesa en este momento?","Escucho que estÃ¡s estresado. Â¿Te ayudarÃ­a hablar sobre algunas de esas preocupaciones?","Tomemos un momento para concentrarnos en lo que estÃ¡ sucediendo ahora. Â¿QuÃ© es algo que estÃ¡ bajo tu control?"],general:["Gracias por compartir eso conmigo. Â¿CuÃ¡nto tiempo has estado sintiÃ©ndote asÃ­?","Te escucho. Â¿QuÃ© mÃ¡s tienes en mente?","Agradezco que te abras. Â¿AyudarÃ­a explorar quÃ© podrÃ­a estar detrÃ¡s de esos sentimientos?","Me alegra que estÃ©s hablando conmigo sobre esto. Â¿QuÃ© crees que te ayudarÃ­a a sentirte mejor ahora mismo?"],askHobbies:["Me gustarÃ­a conocerte mejor. Â¿CuÃ¡les son algunos pasatiempos o actividades que disfrutas?","Â¿QuÃ© te gusta hacer en tu tiempo libre?"],askPlaces:["Â¿Tienes lugares favoritos que te gusta visitar o donde pasar el tiempo?","Â¿Hay algÃºn lugar especial que te ayude a sentirte relajado cuando vas allÃ­?"],askGames:["Â¿Disfrutas jugando algÃºn juego? Â¿Videojuegos, juegos de mesa o deportes quizÃ¡s?","Â¿QuÃ© juegos encuentras mÃ¡s agradables o relajantes?"],askFriends:["Â¿Tienes amigos cercanos con los que te gusta pasar el tiempo?","Â¿QuiÃ©n es alguien que siempre logra animarte cuando te sientes mal?"],askFood:["Â¿QuÃ© tipos de comida disfrutas mÃ¡s?","Â¿Tienes alguna comida reconfortante que te ayude cuando no te sientes bien?"]},fr:{anxiety:["Je remarque que vous vous sentez anxieux. Aimeriez-vous parler davantage de ce qui cause ce sentiment?","L'anxiÃ©tÃ© peut Ãªtre difficile Ã  gÃ©rer. Qu'est-ce qui vous aide Ã  vous sentir plus calme quand vous Ãªtes anxieux?","J'entends de l'anxiÃ©tÃ© dans votre voix. Respirons profondÃ©ment ensemble d'abord, puis vous pourrez m'en dire plus."],depression:["Il semble que vous vous sentez dÃ©primÃ©. Je suis lÃ  pour vous Ã©couter si vous voulez en parler.","Ces sentiments sont valides. Quelle petite chose pourrait vous apporter un moment de paix aujourd'hui?","Merci de partager cela avec moi. La dÃ©pression peut sembler isolante, mais vous n'Ãªtes pas seul en ce moment."],stress:["Il semble que vous Ãªtes sous beaucoup de pression. Qu'est-ce qui vous pÃ¨se le plus en ce moment?","J'entends que vous Ãªtes stressÃ©. Est-ce que parler de certaines de ces prÃ©occupations aiderait?","Prenons un moment pour nous concentrer sur ce qui se passe maintenant. Quelle est une chose qui est sous votre contrÃ´le?"],general:["Merci de partager cela avec moi. Depuis combien de temps vous sentez-vous ainsi?","Je vous Ã©coute. Quoi d'autre avez-vous Ã  l'esprit?","J'apprÃ©cie que vous vous ouvriez. Serait-il utile d'explorer ce qui pourrait Ãªtre derriÃ¨re ces sentiments?","Je suis heureux que vous me parliez de cela. Qu'est-ce qui, selon vous, pourrait vous aider Ã  vous sentir mieux maintenant?"],askHobbies:["J'aimerais mieux te connaÃ®tre. Quels sont tes loisirs ou activitÃ©s que tu aimes?","Qu'aimes-tu faire pendant ton temps libre?"],askPlaces:["As-tu des endroits prÃ©fÃ©rÃ©s que tu aimes visiter ou oÃ¹ passer du temps?","Y a-t-il un endroit spÃ©cial qui t'aide Ã  te sentir dÃ©tendu quand tu y vas?"],askGames:["Aimes-tu jouer Ã  des jeux? Jeux vidÃ©o, jeux de sociÃ©tÃ© ou sports peut-Ãªtre?","Quels jeux trouves-tu les plus agrÃ©ables ou relaxants?"],askFriends:["As-tu des amis proches avec qui tu aimes passer du temps?","Qui est quelqu'un qui toujours logre Ã  te remonter le moral quand tu ne te sens pas bien?"],askFood:["Quels types de nourriture aimes-tu le plus?","As-tu des plats rÃ©confortants qui t'aident quand tu ne te sens pas au mieux?"]}},N=j[u]?u:"en",g=j[N];if(y){if(c.hobbies.length===0)return g.askHobbies[Math.floor(Math.random()*g.askHobbies.length)];if(c.favoritePlaces.length===0)return g.askPlaces[Math.floor(Math.random()*g.askPlaces.length)];if(c.favoriteGames.length===0)return g.askGames[Math.floor(Math.random()*g.askGames.length)];if(c.bestFriends.length===0)return g.askFriends[Math.floor(Math.random()*g.askFriends.length)];if(c.favoriteFood.length===0)return g.askFood[Math.floor(Math.random()*g.askFood.length)]}const C=g[l]||g.general;return C[Math.floor(Math.random()*C.length)]};return{aiResponse:s,shouldPlayVoice:n,processingInput:r,generateAIResponse:x,setAiResponse:t,setShouldPlayVoice:a}}function Cs({sessionActive:s,onVoiceEmotionDetected:t}){const[n,a]=o.useState(""),{aiResponse:r,shouldPlayVoice:i,processingInput:u,generateAIResponse:c,setAiResponse:d,setShouldPlayVoice:h}=Es(),{simulateVoiceEmotionDetection:f}=ks({sessionActive:s,onVoiceEmotionDetected:t}),m=Ns({sessionActive:s,onTranscriptionComplete:w=>{w.trim()&&(a(w),f(),c(w))}}),x=Ss(m.isListening);return{isListening:m.isListening,transcription:n,interimTranscript:m.interimTranscript,aiResponse:r,shouldPlayVoice:i,audioData:x,processingInput:u,sessionActive:s,speechRecognitionSupported:m.speechRecognitionSupported,toggleListening:m.toggleListening,setAiResponse:d,setShouldPlayVoice:h}}function qs({onSessionStart:s,onSessionEnd:t}){const[n,a]=o.useState(!1),r=()=>{a(!0);const c="Hello, I'm Cybella, your AI therapy assistant. I'm here to listen and help you with whatever you're going through. How are you feeling today?";return s&&s(),z({title:"Session started",description:"Your Cybella AI therapy session has begun. Click the microphone and speak when you're ready."}),c},i=()=>{a(!1),R.stop(),z({title:"Session ended",description:"Your Cybella AI therapy session has ended. Thank you for using our service."}),t&&t()};return{sessionActive:n,toggleSession:()=>n?(i(),null):r(),startSession:r,endSession:i}}const xe=o.forwardRef(({className:s,children:t,...n},a)=>e.jsxs(oe,{ref:a,className:S("relative overflow-hidden",s),...n,children:[e.jsx(Oe,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(ye,{}),e.jsx(Ue,{})]}));xe.displayName=oe.displayName;const ye=o.forwardRef(({className:s,orientation:t="vertical",...n},a)=>e.jsx(ae,{ref:a,orientation:t,className:S("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...n,children:e.jsx(He,{className:"relative flex-1 rounded-full bg-border"})}));ye.displayName=ae.displayName;const Is=({onVoiceEmotionDetected:s,onSessionStart:t,onSessionEnd:n})=>{const{t:a}=M(),r=qs({onSessionStart:t,onSessionEnd:n}),i=Cs({sessionActive:r.sessionActive,onVoiceEmotionDetected:s}),u=o.useRef(null),c=()=>{var d;(d=u.current)==null||d.scrollIntoView({behavior:"smooth"})};return o.useEffect(()=>{if(r.sessionActive){const d=a("welcome","voice");i.setAiResponse(d),i.setShouldPlayVoice(!0)}},[r.sessionActive,a]),o.useEffect(()=>{c()},[i.aiResponse,i.transcription]),e.jsx("div",{className:"space-y-4",children:e.jsxs(A,{className:"p-4 md:p-6",children:[e.jsx(ds,{sessionActive:r.sessionActive,toggleSession:r.toggleSession}),e.jsx(xe,{className:"h-[400px] pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(bs,{processingInput:i.processingInput,aiResponse:i.aiResponse,shouldPlayVoice:i.shouldPlayVoice,sessionActive:r.sessionActive}),e.jsx(hs,{transcription:i.transcription,interimTranscript:i.interimTranscript,isListening:i.isListening,sessionActive:r.sessionActive}),e.jsx("div",{ref:u})]})}),e.jsx("div",{className:"mt-4 border-t pt-4",children:e.jsx(js,{isListening:i.isListening,audioData:i.audioData,sessionActive:r.sessionActive,processingInput:i.processingInput,toggleListening:i.toggleListening})})]})})},Ms=({videoRef:s,canvasRef:t,permission:n,isActive:a})=>e.jsxs("div",{children:[e.jsx("video",{ref:s,muted:!0,playsInline:!0,style:{width:"100%",height:"100%"}}),e.jsx("canvas",{ref:t,style:{display:"none"}})]});function Rs(){const{language:s}=M(),t={en:{happy:["You look happy today! It's wonderful to see you in such good spirits.","Your smile is contagious! Whatever you're doing, keep it up!","I notice you're feeling joyful. Moments of happiness are to be cherished.","You seem to be in a great mood! Glad to see things are going well for you.","Your positive energy is radiating through the screen. Keep embracing those good feelings!"],sad:["I notice you seem a bit down. Remember that feelings come and go like weather.","It's okay to feel sad sometimes. Be gentle with yourself today.","Everyone has difficult days. Is there something small you could do to comfort yourself?","I'm noticing a hint of sadness. Remember that you're never alone in how you feel.","Sadness is a natural emotion. Would taking a short break help refresh your mind?"],neutral:["You appear calm and collected right now.","Having a balanced day? Sometimes neutral moments are the perfect time for reflection.","You seem present and focused. That's a great mindset for productivity.","Your expression is balanced - a perfect state for clear thinking.","You look composed and centered. A good state of mind for making decisions."],angry:["I notice you might be feeling frustrated. Taking a few deep breaths can help center your thoughts.","It seems you might be experiencing some tension. Would stepping away for a moment help?","I detect some signs of frustration. Remember that emotions are temporary visitors.","Your expression suggests you might be upset about something. It's okay to acknowledge that feeling.","When anger arises, it often helps to pause before responding to situations."],fearful:["You appear a bit concerned. Remember that many fears look smaller when we face them directly.","I notice signs of worry in your expression. Is there something specific on your mind?","Anxiety often comes from thinking about what might happen. Bringing focus to the present moment can help.","Your expression suggests some worry. Remember that you've overcome difficult situations before.","When feeling anxious, slow, deep breathing can help calm your nervous system."],surprised:["You look surprised! Did something unexpected happen?","Your expression shows astonishment. Unexpected moments can lead to new insights.","Surprise is often our mind adjusting to new information. Give yourself time to process.","That's quite the surprised look! Sometimes life's unexpected turns lead to the best opportunities.","Your surprise is noticeable. I hope it's related to something positive!"]},es:{happy:["Â¡Te ves feliz hoy! Es maravilloso verte con tan buen Ã¡nimo.","Â¡Tu sonrisa es contagiosa! Lo que sea que estÃ©s haciendo, Â¡sigue asÃ­!","Noto que te sientes alegre. Los momentos de felicidad son para apreciarlos."],sad:["Noto que pareces un poco decaÃ­do. Recuerda que los sentimientos vienen y van como el clima.","EstÃ¡ bien sentirse triste a veces. SÃ© amable contigo mismo hoy.","Todos tenemos dÃ­as difÃ­ciles. Â¿Hay algo pequeÃ±o que podrÃ­as hacer para consolarte?"],neutral:["Te ves tranquilo y sereno en este momento.","Â¿Teniendo un dÃ­a equilibrado? A veces los momentos neutros son perfectos para reflexionar.","Pareces presente y concentrado. Ese es un gran estado mental para la productividad."],angry:["Noto que podrÃ­as sentirte frustrado. Tomar algunas respiraciones profundas puede ayudar a centrar tus pensamientos.","Parece que podrÃ­as estar experimentando algo de tensiÃ³n. Â¿AyudarÃ­a alejarte un momento?","Detecto algunos signos de frustraciÃ³n. Recuerda que las emociones son visitantes temporales."],fearful:["Pareces un poco preocupado. Recuerda que muchos miedos parecen mÃ¡s pequeÃ±os cuando los enfrentamos directamente.","Noto signos de preocupaciÃ³n en tu expresiÃ³n. Â¿Hay algo especÃ­fico en tu mente?","La ansiedad a menudo viene de pensar en lo que podrÃ­a pasar. Traer el enfoque al momento presente puede ayudar."],surprised:["Â¡Te ves sorprendido! Â¿OcurriÃ³ algo inesperado?","Tu expresiÃ³n muestra asombro. Los momentos inesperados pueden conducir a nuevas perspectivas.","La sorpresa es a menudo nuestra mente ajustÃ¡ndose a nueva informaciÃ³n. Date tiempo para procesar."]},fr:{happy:["Vous semblez heureux aujourd'hui! C'est merveilleux de vous voir de si bonne humeur.","Votre sourire est contagieux! Quoi que vous fassiez, continuez comme Ã§a!","Je remarque que vous vous sentez joyeux. Les moments de bonheur sont Ã  chÃ©rir."],sad:["Je remarque que vous semblez un peu triste. Rappelez-vous que les sentiments vont et viennent comme la mÃ©tÃ©o.","C'est normal de se sentir triste parfois. Soyez doux avec vous-mÃªme aujourd'hui.","Tout le monde a des jours difficiles. Y a-t-il quelque chose de petit que vous pourriez faire pour vous rÃ©conforter?"],neutral:["Vous semblez calme et posÃ© en ce moment.","Une journÃ©e Ã©quilibrÃ©e? Parfois, les moments neutres sont parfaits pour la rÃ©flexion.","Vous semblez prÃ©sent et concentrÃ©. C'est un excellent Ã©tat d'esprit pour la productivitÃ©."],angry:["Je remarque que vous pourriez vous sentir frustrÃ©. Prendre quelques respirations profondes peut aider Ã  centrer vos pensÃ©es.","Il semble que vous pourriez ressentir de la tension. Est-ce que s'Ã©loigner un moment aiderait?","Je dÃ©tecte des signes de frustration. Rappelez-vous que les Ã©motions sont des visiteurs temporaires."],fearful:["Vous semblez un peu inquiet. Rappelez-vous que de nombreuses peurs paraissent plus petites lorsque nous les affrontons directement.","Je remarque des signes d'inquiÃ©tude dans votre expression. Y a-t-il quelque chose de spÃ©cifique dans votre esprit?","L'anxiÃ©tÃ© vient souvent de penser Ã  ce qui pourrait arriver. Ramener l'attention au moment prÃ©sent peut aider."],surprised:["Vous avez l'air surpris! Quelque chose d'inattendu s'est-il produit?","Votre expression montre de l'Ã©tonnement. Les moments inattendus peuvent mener Ã  de nouvelles perspectives.","La surprise est souvent notre esprit qui s'ajuste Ã  de nouvelles informations. Donnez-vous le temps de traiter."]}};return{getRandomMessageForEmotion:a=>{const r=t[s]?s:"en",i=t[r][a];return i[Math.floor(Math.random()*i.length)]}}}const zs={happy:"You're radiating happiness! Enjoy every moment.",neutral:"You look composed and centeredâ€”a great state for making decisions.",sad:"It seems you're feeling down. Sometimes a friendly chat or a little break can lift your spirits.",angry:"Everyone has difficult days. Is there something small you could do to comfort yourself?",fearful:"You seem anxious. Try taking deep breaths or stepping away for a moment.",disgusted:"Your expression shows disgust. A change of scenery or a short break could be refreshing.",surprised:"You look surprised! Take a moment to gather your thoughts.",anxious:"Everyone has difficult days. Is there something small you could do to comfort yourself?"},Ts=["sad","angry","fearful","disgusted","anxious"],As=({emotion:s,confidence:t})=>{const[n,a]=o.useState(""),[r,i]=o.useState(""),[u,c]=o.useState(!1),[d,h]=o.useState(0),f=o.useRef(0),{getRandomMessageForEmotion:p}=Rs(),{preferences:m}=re(),x=120,w=15,v=.65,q=(N,g)=>{if(!Object.values(m).some(b=>b.length>0))return N;const k=[];if(m.hobbies.length>0){const b=m.hobbies[Math.floor(Math.random()*m.hobbies.length)];k.push(`Why not spend some time ${b}?`)}if(m.favoritePlaces.length>0){const b=m.favoritePlaces[Math.floor(Math.random()*m.favoritePlaces.length)];k.push(`Maybe visit ${b}?`)}if(m.favoriteGames.length>0){const b=m.favoriteGames[Math.floor(Math.random()*m.favoriteGames.length)];k.push(`Perhaps playing ${b} could help.`)}if(m.bestFriends.length>0){const b=m.bestFriends[Math.floor(Math.random()*m.bestFriends.length)];k.push(`Have a chat with ${b}.`)}if(m.favoriteFood.length>0){const b=m.favoriteFood[Math.floor(Math.random()*m.favoriteFood.length)];k.push(`Treat yourself to some ${b}.`)}if(k.length>0){const b=k[Math.floor(Math.random()*k.length)];return`${N} ${b}`}return N};if(o.useEffect(()=>{if(!s||t<v)return;const g=Date.now()/1e3-f.current;if(!u||g>=w){let C=p(s)||zs[s.toLowerCase()]||"";Ts.includes(s.toLowerCase())&&(C=q(C,s.toLowerCase())),C&&C!==n&&a(C)}},[s,t,m,p,n,u]),o.useEffect(()=>{if(!n)return;i(n),c(!0),h(x),f.current=Date.now()/1e3;const N=setTimeout(()=>{c(!1),i("")},x*1e3);return()=>clearTimeout(N)},[n]),o.useEffect(()=>{if(!u||d<=0)return;const N=setInterval(()=>{h(g=>Math.max(0,g-1))},1e3);return()=>clearInterval(N)},[u,d]),!u)return null;const E={happy:"bg-green-200 border-green-400",neutral:"bg-blue-200 border-blue-400",sad:"bg-blue-200 border-blue-400",angry:"bg-red-200 border-red-400",fearful:"bg-purple-200 border-purple-400",disgusted:"bg-yellow-200 border-yellow-400",surprised:"bg-orange-200 border-orange-400",anxious:"bg-pink-200 border-pink-400"},l=s?s.toLowerCase():"neutral",y=E[l]||"bg-gray-200 border-gray-400",j=()=>{const N=Math.floor(d/60),g=d%60;return`${N}:${g.toString().padStart(2,"0")}`};return e.jsxs(Ze,{className:`mt-2 ${y}`,children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),e.jsxs(es,{className:"text-sm",children:[r,e.jsxs("div",{className:"flex items-center mt-2 text-xs text-muted-foreground",children:[e.jsx($e,{className:"h-3 w-3 mr-1"}),j()]})]})]})},Ls=({error:s,isActive:t,modelsLoaded:n,connectionIssue:a=!1,cameraRequested:r=!1,onRequestCamera:i})=>s?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4 text-center bg-black/10 backdrop-blur-sm",children:e.jsx("p",{className:"text-sm text-red-500 font-medium",children:s})}):a&&t?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 backdrop-blur-sm",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("p",{className:"text-sm text-amber-500 font-medium mb-1",children:"Connection Issues Detected"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Network connection issues detected. This may affect facial recognition."})]})}):t?t&&!r&&i?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 backdrop-blur-sm z-10",children:e.jsxs("div",{className:"text-center",children:[e.jsxs(T,{onClick:i,size:"lg",className:"flex items-center gap-2 mb-2",children:[e.jsx(Ge,{size:20}),"Enable Camera"]}),e.jsx("p",{className:"text-xs text-muted-foreground max-w-[260px]",children:"Browser security requires user interaction before enabling camera access"})]})}):!n&&r?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 backdrop-blur-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary mb-2"}),e.jsx("p",{className:"text-sm text-center px-4 text-muted-foreground",children:"Loading face detection models..."})]})}):null:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 backdrop-blur-sm",children:e.jsx("p",{className:"text-sm text-center px-4 text-muted-foreground",children:'Click "Start Session" to enable facial analysis'})}),Fs=({videoRef:s,canvasRef:t,permission:n,error:a,modelsLoaded:r,connectionIssue:i,isActive:u,emotion:c,confidence:d,requestCameraAccess:h,cameraRequested:f})=>{const p=async()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{const x=await navigator.mediaDevices.getUserMedia({video:!0});s.current&&!s.current.srcObject&&(s.current.srcObject=x,await s.current.play())}catch(x){console.error("Error playing video:",x),alert("Error accessing the camera. Please check your browser settings.")}else alert("Your browser does not support media devices.")},m=async()=>{await p(),h()};return e.jsxs(A,{className:"overflow-hidden relative",children:[e.jsxs("div",{className:"aspect-video bg-muted relative overflow-hidden rounded-md",children:[e.jsx(Ls,{error:a,isActive:u,modelsLoaded:r,connectionIssue:i,cameraRequested:f,onRequestCamera:m}),e.jsx(Ms,{videoRef:s,canvasRef:t,permission:n,isActive:u})]}),u&&n&&r&&c&&e.jsx(As,{emotion:c,confidence:d})]})};function Ps({videoRef:s}){const[t,n]=o.useState(!1),[a,r]=o.useState(null),i=o.useRef(null),u=o.useRef(!0);o.useEffect(()=>()=>{u.current=!1,d()},[]);const c=o.useCallback(async()=>{try{if(!u.current)return;s.current&&s.current.srcObject&&(s.current.srcObject.getTracks().forEach(p=>p.stop()),s.current.srcObject=null),console.log("Requesting camera access after user interaction...");const h=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user",frameRate:{ideal:15}}});if(!u.current){h.getTracks().forEach(f=>f.stop());return}console.log("Camera access granted, setting up video stream"),i.current=h,s.current&&(s.current.srcObject=h,s.current.onloadedmetadata=async()=>{var f;try{await((f=s.current)==null?void 0:f.play()),console.log("Video playback started successfully"),u.current&&(n(!0),r(null))}catch(p){console.error("Error playing video:",p),u.current&&r("Camera autoplay blocked. Please reload the page and try again.")}})}catch(h){if(!u.current)return;console.error("Error accessing webcam:",h),n(!1);let f="Unable to access webcam. Please ensure your camera is connected and working properly.";h instanceof DOMException&&(h.name==="NotAllowedError"?f="Camera access denied. Please grant camera permissions in your browser settings.":h.name==="NotFoundError"?f="No camera found. Please connect a camera and try again.":h.name==="NotReadableError"&&(f="Camera is already in use by another application. Please close other applications using the camera.")),r(f),console.error(f)}},[s]),d=o.useCallback(()=>{console.log("Stopping webcam..."),i.current&&(i.current.getTracks().forEach(h=>{console.log("Stopping track:",h.kind),h.stop()}),i.current=null),s.current&&(s.current.srcObject=null,n(!1))},[s]);return{permission:t,error:a,initializeWebcam:c,stopWebcam:d}}function Ds(){const[s,t]=o.useState(!1),[n,a]=o.useState(0),r=2;return o.useEffect(()=>{const i=async()=>{try{const u="https://justadudewhohacks.github.io/face-api.js/models";await Promise.all([V.tinyFaceDetector.loadFromUri(u),V.faceExpressionNet.loadFromUri(u)]),t(!0),z({title:"Face detection ready",description:"Models loaded successfully",duration:3e3})}catch(u){console.error("Error loading facial recognition models:",u),n<r?(a(c=>c+1),z({title:"Retrying model loading",description:`Attempt ${n+1} of ${r}`,variant:"destructive"}),setTimeout(()=>i(),2e3)):z({title:"Face detection models failed to load",description:"Please refresh the page and try again.",variant:"destructive"})}};i()},[n]),{modelsLoaded:s}}function Vs({videoRef:s,canvasRef:t,showDetectionVisuals:n=!0}){const a=o.useRef(0),r=200,i=o.useRef(!1);return{detectEmotion:o.useCallback(async()=>{if(!s.current||!t.current||i.current)return null;if(s.current.paused||s.current.ended||s.current.readyState<2)return console.log("Video not ready yet, readyState:",s.current.readyState),null;i.current=!0;try{const c=s.current,d=t.current;if(!c.videoWidth||!c.videoHeight)return console.log("Video dimensions not available"),i.current=!1,null;const h={width:c.videoWidth,height:c.videoHeight};Be(d,h);const f=new _e({inputSize:224,scoreThreshold:.5}),p=new AbortController,m=setTimeout(()=>p.abort(),3e3);try{const x=await Je(c,f).withFaceExpressions();clearTimeout(m);const w=d.getContext("2d");if(w&&w.clearRect(0,0,d.width,d.height),x&&x.length>0){const v=Ke(x,h);n&&Xe(d,v);const q={happy:"happy",sad:"sad",neutral:"neutral",angry:"angry",fearful:"fearful",surprised:"surprised",disgusted:"angry"},E=x[0].expressions;let l="neutral",y=0;return Object.entries(E).forEach(([j,N])=>{N>y&&(y=N,l=q[j]||"neutral")}),console.log("Detected emotion:",l,"with confidence:",y),i.current=!1,{emotion:l,confidence:y}}}catch(x){clearTimeout(m),x.name==="AbortError"?console.log("Face detection timed out"):console.error("Face detection error:",x)}return i.current=!1,null}catch(c){return console.error("Error in emotion detection:",c),i.current=!1,null}},[s,t,n]),lastProcessTimeRef:a,PROCESS_INTERVAL_MS:r}}function Ws({videoRef:s,canvasRef:t,isActive:n,cameraRequested:a=!1,onEmotionDetected:r}){const[i,u]=o.useState(null),[c,d]=o.useState(!1),[h,f]=o.useState(null),p=o.useRef(null),m=o.useRef(!0);o.useEffect(()=>()=>{m.current=!1},[]),o.useEffect(()=>{const g=()=>{d(!navigator.onLine)};return window.addEventListener("online",g),window.addEventListener("offline",g),g(),()=>{window.removeEventListener("online",g),window.removeEventListener("offline",g)}},[]);const{permission:x,error:w,initializeWebcam:v,stopWebcam:q}=Ps({videoRef:s}),{modelsLoaded:E}=Ds(),{detectEmotion:l,lastProcessTimeRef:y,PROCESS_INTERVAL_MS:j}=Vs({videoRef:s,canvasRef:t,showDetectionVisuals:!0});o.useEffect(()=>{w&&u(w)},[w]),o.useEffect(()=>(console.log("FacialRecognition status - isActive:",n,"cameraRequested:",a),n&&a&&m.current?(console.log("Initializing webcam - user interaction detected"),v().catch(g=>{console.error("Failed to initialize webcam:",g)})):n||(console.log("Stopping webcam"),q()),()=>{console.log("Cleanup function called"),q(),p.current&&(cancelAnimationFrame(p.current),p.current=null)}),[n,a,v,q]),o.useEffect(()=>{const g=async C=>{if(m.current){if(n&&x&&E&&C-y.current>=j)try{const b=await l();b&&m.current&&(console.log("Emotion detected:",b.emotion,b.confidence),(!h||b.confidence>h.confidence+.15||b.emotion!==h.emotion&&b.confidence>.65)&&(f(b),r&&(console.log("Calling onEmotionDetected with:",b.emotion,b.confidence),r(b.emotion,b.confidence)))),y.current=C}catch(b){console.error("Error during emotion detection:",b)}m.current&&(p.current=requestAnimationFrame(g))}};return n&&x&&E&&m.current&&(console.log("Starting emotion detection loop"),p.current=requestAnimationFrame(g)),()=>{p.current&&(console.log("Stopping emotion detection loop"),cancelAnimationFrame(p.current),p.current=null)}},[n,x,E,l,r,y,j]);const N=o.useCallback(()=>{console.log("Camera access explicitly requested by user"),n&&m.current&&v().catch(g=>{console.error("Failed to initialize webcam after user interaction:",g)})},[n,v]);return{permission:x,error:i,modelsLoaded:E,connectionIssue:c,requestCameraAccess:N}}const be=o.createContext(void 0);function Ys({children:s}){const[t,n]=o.useState(null),[a,r]=o.useState(0),i=(u,c)=>{n(u),r(c)};return e.jsx(be.Provider,{value:{stableEmotion:t,stableConfidence:a,setEmotionData:i},children:s})}function Os(){const s=o.useContext(be);if(s===void 0)throw new Error("useEmotion must be used within an EmotionProvider");return s}const Us=({onEmotionDetected:s,isActive:t})=>{const n=o.useRef(null),a=o.useRef(null),{stableEmotion:r,stableConfidence:i,setEmotionData:u}=Os(),[c,d]=o.useState(!1),h=(q,E)=>{u(q,E),s&&s(q,E)},{permission:f,error:p,modelsLoaded:m,connectionIssue:x,requestCameraAccess:w}=Ws({videoRef:n,canvasRef:a,isActive:t,cameraRequested:c,onEmotionDetected:h}),v=()=>{d(!0),w()};return e.jsx(Fs,{videoRef:n,canvasRef:a,permission:f,error:p,modelsLoaded:m,connectionIssue:x,isActive:t,emotion:r,confidence:i,requestCameraAccess:v,cameraRequested:c})},Hs=s=>e.jsx(Ys,{children:e.jsx(Us,{...s})}),W={happy:"bg-therapeutic-calm",sad:"bg-therapeutic-tranquil",neutral:"bg-therapeutic-serene",angry:"bg-red-400",surprised:"bg-therapeutic-relaxed",fearful:"bg-therapeutic-peaceful"},Y={happy:"ðŸ˜Š",sad:"ðŸ˜”",neutral:"ðŸ˜",angry:"ðŸ˜ ",surprised:"ðŸ˜®",fearful:"ðŸ˜¨"},Qs=({faceEmotion:s,voiceEmotion:t,confidence:n={face:0,voice:0}})=>!s&&!t?null:e.jsxs(A,{className:"p-4 md:p-6 shadow-sm bg-white/60 dark:bg-gray-800/60 backdrop-blur-sm",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Current Emotional State"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg bg-gradient-to-br from-white/80 to-gray-100/80 dark:from-gray-700/80 dark:to-gray-800/80",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${W[s]||"bg-gray-200"}`,children:e.jsx("span",{className:"text-xl",role:"img","aria-label":s,children:Y[s]||"ðŸ™‚"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Facial Expression"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"capitalize text-sm",children:s}),n.face!==void 0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[Math.round(n.face*100),"%"]})]})]})]}),t&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg bg-gradient-to-br from-white/80 to-gray-100/80 dark:from-gray-700/80 dark:to-gray-800/80",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${W[t]||"bg-gray-200"}`,children:e.jsx("span",{className:"text-xl",role:"img","aria-label":t,children:Y[t]||"ðŸ™‚"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Voice Tone"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"capitalize text-sm",children:t}),n.voice!==void 0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[Math.round(n.voice*100),"%"]})]})]})]})]})]}),_s=()=>{const[s,t]=o.useState(!1),[n,a]=o.useState(null),[r,i]=o.useState(null),[u,c]=o.useState({face:0,voice:0}),{t:d}=M(),h=(x,w)=>{a(x),c(v=>({...v,face:w}))},f=(x,w)=>{i(x),c(v=>({...v,voice:w}))},p=()=>{t(!0)},m=()=>{t(!1),a(null),i(null)};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-soothing",children:[e.jsx(ls,{}),e.jsx("main",{className:"flex-1 container py-6 md:py-10 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs(A,{className:"border-none shadow-sm bg-white/80 dark:bg-gray-900/80 backdrop-blur",children:[e.jsxs(me,{children:[e.jsx(he,{className:"text-2xl md:text-3xl",children:d("title","index")}),e.jsx(fe,{children:d("description","index")})]}),e.jsx(ge,{children:e.jsx("p",{className:"text-muted-foreground mb-4",children:d("introduction","index")})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Is,{onVoiceEmotionDetected:f,onSessionStart:p,onSessionEnd:m}),e.jsx(Hs,{onEmotionDetected:h,isActive:s})]}),e.jsx(Qs,{faceEmotion:n,voiceEmotion:r,confidence:u})]})}),e.jsx(cs,{}),e.jsx(ss,{})]})};export{_s as default};
